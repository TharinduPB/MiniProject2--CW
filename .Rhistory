plot_ly() %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified", color = "red",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", color = "blue", size=0.8,
line=(list(width = 1))) %>%
add_trace(x=res_full_3$timestamp, y=res_full_3$level, type="scatter",
mode= "lines", name="rate of rise cleaned", color = "green", size=0.9,
line=(list(width = 1)))
plot_ly() %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified", color = "red",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", color = "blue", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%)
plot_ly() %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
ylim(430,450) %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) %>%
add_trace(x=res_full_3$timestamp, y=res_full_3$level, type="scatter",
mode= "lines", name="rate of rise cleaned", color = "green", size=0.9,
line=(list(width = 1)))
res_may21 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-05-01"),
as.Date("2021-05-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_may21 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-05-01"),
as.Date("2021-05-31")))
res_may_1 <- phycon(res_may21,447.8,435.0,3.5)
res_may_2 <- sgfilter(res_may_1,6,99,0.03)
res_may_3 <- raterise(res_may_2,0.0023,250)
plot_ly() %>%
add_trace(x= res_may21$timestamp, y=res_may21$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_may_2$timestamp, y=res_may_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
res_may21 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2022-05-01"),
as.Date("2022-05-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_may21 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2022-05-01"),
as.Date("2022-05-31")))
res_may_1 <- phycon(res_may21,447.8,435.0,3.5)
res_may_2 <- sgfilter(res_may_1,6,99,0.03)
res_may_3 <- raterise(res_may_2,0.0023,250)
plot_ly() %>%
add_trace(x= res_may21$timestamp, y=res_may21$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_may_2$timestamp, y=res_may_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_may_2$timestamp, y=res_may_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1)))
plot_ly() %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1))) #%>%
plot_ly() %>%
add_trace(x= res_may21$timestamp, y=res_may21$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1))) #%>%
res_may21 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2017-05-01"),
as.Date("2017-05-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_may21 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2017-05-01"),
as.Date("2017-05-31")))
res_may_1 <- phycon(res_may21,447.8,435.0,3.5)
res_may_2 <- sgfilter(res_may_1,6,99,0.03)
res_may_3 <- raterise(res_may_2,0.0023,250)
plot_ly() %>%
add_trace(x= res_may21$timestamp, y=res_may21$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_may_2$timestamp, y=res_may_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
plot_ly() %>%
# add_trace(x= res_may21$timestamp, y=res_may21$level, type="scatter",
#           mode= "lines", name="original",size= 0.5,
#           line=(list(width = 1))) %>%
add_trace(x=verified_may21$timestamp, y=verified_may21$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1))) #%>%
gc()
library(tidyverse)
library(plotly)
library(TTR)
library(zoo)
library(signal)
library(levelSmoothing)
res_2021 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
res_2021_1 <- phycon(res_2021,447.8,435.0,3.5)
res_2021_2 <- sgfilter(res_2021_1,6,99,0.03)
res_2021_3 <- raterise(res_2021_2,0.0023,250)
plot_ly() %>%
add_trace(x=verified_2021$timestamp, y=verified_2021$level, type="scatter",
mode= "lines", name="verified", color = "red",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_2021_2$timestamp, y=res_2021_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", color = "blue", size=0.8,
line=(list(width = 1))) %>%
add_trace(x=res_2021_3$timestamp, y=res_2021_3$level, type="scatter",
mode= "lines", name="rate of rise cleaned", color = "green", size=0.9,
line=(list(width = 1)))
plot_ly() %>%
add_trace(x=verified_2021$timestamp, y=verified_2021$level, type="scatter",
mode= "lines", name="verified", color = "red",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_2021_2$timestamp, y=res_2021_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", color = "blue", size=0.8,
line=(list(width = 1)))
plot_ly() %>%
add_trace(x=verified_2021$timestamp, y=verified_2021$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_2021_2$timestamp, y=res_2021_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1)))
res_full <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2017-01-01"),
as.Date("2022-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_full <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2017-01-01"),
as.Date("2022-12-31")))
res_full_1 <- phycon(res_full,447.8,435.0,3.5)
res_full_2 <- sgfilter(res_full_1,6,99,0.03)
res_full_3 <- raterise(res_full_2,0.0023,250)
plot_ly() %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
res_2021_3 <- raterise(res_2021_2,0.0023,288)
plot_ly() %>%
add_trace(x=verified_2021$timestamp, y=verified_2021$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_2021_2$timestamp, y=res_2021_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1)))
plot_ly() %>%
add_trace(x=verified_2021$timestamp, y=verified_2021$level, type="scatter",
mode= "lines", name="verified", color = "red",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_2021_2$timestamp, y=res_2021_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", color = "blue", size=0.8,
line=(list(width = 1))) %>%
add_trace(x=res_2021_3$timestamp, y=res_2021_3$level, type="scatter",
mode= "lines", name="rate of rise cleaned", color = "green", size=0.9,
line=(list(width = 1)))
malmsbury_21 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
malmsbury_21_ori <- malmsbury_21
full_supply_level <- 447.8
min_level <- 435.0
malmsbury_21 <- malmsbury_21 %>%
mutate(min = level <= min_level,
FSL = level > full_supply_level + 2,
MAD = abs(level - median(level)) / mad(level) >= 3.5
)
malmsbury_21 <- malmsbury_21 %>%
dplyr::filter (!FSL, !min, !MAD)
malmsbury_play <- malmsbury_21
malm_level <- malmsbury_play$level
malm_time <- malmsbury_play$timestamp
malmsbury_zoo <- zoo(malm_level, malm_time)
malmsbury_cleaned<- malmsbury_play %>%
mutate( ewma = ewma <- EMA(malmsbury_zoo, n = 288))
smoothed <- sgolayfilt(malmsbury_21$level, p = 6, n = 99)
smoothed1 <- sgolayfilt(malmsbury_21$level, p = 4, n = 99)
malmsbury_cleaned <- malmsbury_cleaned %>%
mutate( sg_smooth = sg_smooth <- sgolayfilt(malmsbury_cleaned$level, p = 4, n = 99),
sg_diff = sg_diff <- abs(sg_smooth - level),
sg_diff_con = sg_diff >= 0.03)
malmsbury_cleaned1 <- malmsbury_cleaned %>%
dplyr::filter(!sg_diff_con)
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
verified_level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
malmsbury_rate_rise <- malmsbury_cleaned1[1:2]
malmsbury_rate_rise <- malmsbury_rate_rise %>%
mutate(  dh = dh <- abs(malmsbury_rate_rise$level - lag(malmsbury_rate_rise$level)),
dt = dt <- malmsbury_rate_rise$timestamp - lag(malmsbury_rate_rise$timestamp),
rate = rate <- dh / as.numeric(dt),
)
malmsbury_rate_rise <- malmsbury_rate_rise %>%
mutate (rate_rise = rate_rise <- rate >= 0.0023)
plot_ly() %>%
# add_trace(x = malmsbury_21_or$timestamp , y = malmsbury_21_ori$level, type = "scatter",
#            mode = "lines", name = "Original", line=(list(width =0.5))) %>%
add_trace(x = malmsbury_21$timestamp, y = malmsbury_21$level, type = "scatter",
mode = "lines" , name = "FSL and Min removed", line=(list(width = 0.75))) %>%
add_trace(x= verified_2021$timestamp, y =verified_2021$verified_level, type = "scatter",
mode = "lines", name= "wims", line = (list(width = 1))) %>%
# add_trace(x=malmsbury_cleaned$timestamp, y=malmsbury_cleaned$level, type = "scatter",
#           mode= "lines",name="ewma", line = (list(width = 1)))%>%
add_trace(x = malmsbury_cleaned1$timestamp, y = malmsbury_cleaned1$level , type = "scatter",
mode = "lines", name = "sg cleaned", line=(list(width = 1.5))) %>%
add_trace(x = malmsbury_rate_rise1$timestamp, y = malmsbury_rate_rise1$level , type = "scatter",
mode = "lines", name = "rate of rise", line=(list(width = 1.5))) %>%
layout(title = 'original vs smooth',
xaxis = list(title = 'timestamp'),
yaxis = list(title = 'level'))
# finding the indexes of the rate of rise
malmsbury_rate_rise1 <- malmsbury_rate_rise
rate_of_rise_indices <- which(malmsbury_rate_rise1$rate_rise== TRUE)
# Iterate over the outlier indices
for (index in rate_of_rise_indices) {
# Remove index + 250 points
malmsbury_rate_rise1 <- malmsbury_rate_rise1[-c(index:(index + 250)) ,]
}
plot_ly() %>%
# add_trace(x = malmsbury_21$timestamp, y = malmsbury_21$level, type = "scatter",
#           mode = "lines" , name = "FSL and Min removed", line=(list(width = 0.75))) %>%
add_trace(x= verified_2021$timestamp, y =verified_2021$verified_level, type = "scatter",
mode = "lines", name= "wims", line = (list(width = 1))) %>%
add_trace(x=malmsbury_rate_rise1$timestamp, y=malmsbury_rate_rise1$level, type = "scatter",
mode= "lines",name="rate of rise removed", line = (list(width = 1)))%>%
layout(title = 'original vs smooth',
xaxis = list(title = 'timestamp'),
yaxis = list(title = 'level'))
load("~/Miniproject2_CW_smoothing reservoir levels/levelSmoothing/.RData")
library(tidyverse)
library(plotly)
library(TTR)
library(zoo)
library(signal)
library(levelSmoothing)
res_2021 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
res_2021_1 <- phycon(res_2021,447.8,435.0,3.5)
res_2021_2 <- sgfilter(res_2021_1,6,99,0.03)
res_2021_3 <- raterise(res_2021_2,0.0023,288)
plot_ly() %>%
add_trace(x=verified_2021$timestamp, y=verified_2021$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_2021_2$timestamp, y=res_2021_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1)))
res_full <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2017-01-01"),
as.Date("2022-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_full <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2017-01-01"),
as.Date("2022-12-31")))
res_full_1 <- phycon(res_full,447.8,435.0,3.5)
res_full_2 <- sgfilter(res_full_1,6,99,0.03)
res_full_3 <- raterise(res_full_2,0.0023,250)
plot_ly() %>%
add_trace(x= res_full$timestamp, y=res_full$level, type="scatter",
mode= "lines", name="original",size= 0.5,
line=(list(width = 1))) %>%
add_trace(x=verified_full$timestamp, y=verified_full$level, type="scatter",
mode= "lines", name="verified",size= 0.5,
line=(list(width = 1)))%>%
add_trace(x=res_full_2$timestamp, y=res_full_2$level, type="scatter",
mode= "lines", name="cleaned_sgfilter", size=0.8,
line=(list(width = 1))) #%>%
library(tidyverse)
library(plotly)
library(TTR)
library(zoo)
library(signal)
library(levelSmoothing)
res_2021 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
res_2021_1 <- phycon(res_2021,447.8,435.0,3.5)
res_2021_2 <- sgfilter(res_2021_1,6,99,0.03)
res_2021_3 <- raterise(res_2021_2,0.0023,288)
sq_val <- (res_2021_2$level - verified_2021$level)^2
res_2021 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
full_supply_level <- 447.8
min_level <- 435.0
malmsbury_21 <- malmsbury_21 %>%
mutate(min = level <= min_level,
FSL = level > full_supply_level + 2,
MAD = abs(level - median(level)) / mad(level) >= 3.5
)
malmsbury_21 <- malmsbury_21 %>%
dplyr::filter (!FSL, !min, !MAD)
malmsbury_21 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
verified_level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
malmsbury_21_ori <- malmsbury_21
full_supply_level <- 447.8
min_level <- 435.0
malmsbury_21 <- malmsbury_21 %>%
mutate(min = level <= min_level,
FSL = level > full_supply_level + 2,
MAD = abs(level - median(level)) / mad(level) >= 3.5
)
malmsbury_21 <- malmsbury_21 %>%
dplyr::filter (!FSL, !min, !MAD)
malmsbury_21 <- read_csv("rawdata.csv") %>%
select(timestamp = Timestamp, level = Level1) %>%
arrange(timestamp) %>%
dplyr::filter( !is.na(level) & level !=0 & between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
# Read verified data
verified <- read_csv("406220.csv")  %>%
select(timestamp = Datetime ,
verified_level = `Water Level` ,
qc = QC ) %>%
mutate(timestamp = lubridate::dmy_hms(timestamp))
verified_2021 <- verified %>%
arrange(timestamp) %>%
dplyr::filter( between(as.Date(timestamp), as.Date("2021-01-01"),
as.Date("2021-12-31")))
malmsbury_21_ori <- malmsbury_21
malmsbury_21 <- malmsbury_21 %>%
mutate(min = level <= min_level,
FSL = level > full_supply_level + 2,
MAD = abs(level - median(level)) / mad(level) >= 3.5
)
